<!DOCTYPE html>
<html lang="vi">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7cf">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Streak Clicker</title>
  <style>
  :root {
    --accent: #ff914d;       /* cam sáng */
    --accent-2: #ff6a00;     /* cam đậm */
    --text: #e4e8ff;         
    --muted: #8a92b2;        
    --bg: #0b0f1d;           
  }

  body {
    margin: 0;
    font-family: "Inter", Arial, sans-serif;
    background: linear-gradient(160deg, #0b0f1d 0%, #111832 40%, #06080f 100%);
    color: var(--text);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .streak-card {
    padding: 28px 20px;
    max-width: 420px;
    width: 100%;
    border-radius: 18px;
    background: rgba(20, 25, 40, 0.9);
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
    text-align: center;   /* ✅ căn giữa toàn bộ nội dung */
  }

  /* flame + số */
  .flame {
    font-size: 72px;
    margin-bottom: 8px;
  }
  .count {
    font-size: clamp(44px, 9vw, 72px);
    font-weight: 800;
    color: var(--accent);
    text-shadow: 0 0 12px rgba(255,165,0,0.5);
  }
  .label {
    font-size: 16px;
    color: var(--muted);
    margin-bottom: 20px;
  }

  /* tuần */
  .week {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 20px 0;
  }
  .day {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    color: var(--muted);
    background: #1a2139;
    border: 1px solid rgba(255,255,255,0.06);
    transition: background 0.3s ease, color 0.3s ease;
  }
  .day.checked {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: #fff;
    box-shadow: 0 0 10px rgba(255,140,0,0.6);
  }

  /* subtext */
  .subtext {
    font-size: 13px;
    color: var(--muted);
    margin: 20px 0;
  }
  .subtext .highlight {
    color: var(--accent);
    font-weight: bold;
  }

  /* nút */
  .actions { 
    display: grid; 
    gap: 10px; 
    margin-top: 12px; 
  }
  button {
    appearance: none;
    border: 0;
    border-radius: 14px;
    padding: 14px 16px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(180deg, #1a2544, #0f1833);
    color: white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35),
                inset 0 0 0 1px rgba(255,255,255,0.05);
    transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
  }
  button:hover { filter: brightness(1.08); }
  button:active { transform: translateY(1px); }
  button[disabled] { opacity: .55; cursor: not-allowed; }

  .btn-accent { 
    background-image: linear-gradient(135deg, var(--accent), var(--accent-2)); 
    color: #fff; 
  }
  .btn-subtle { 
    background-image: linear-gradient(180deg, #1a223a, #0f1730); 
    color: var(--text); 
    font-weight: 600; 
  }
  .btn-danger { 
    background-image: linear-gradient(180deg, #3b1620, #2a0d14); 
    color: #ffdede; 
  }
  </style>
</head>
<body>
  <main class="app">
    <div class="streak-card">
      <div class="flame">🔥</div>
      <div class="count" id="streak">0</div>
      <div class="label">day streak</div>

      <div class="week" id="week-grid">
        <div class="day" data-dow="0">Su</div>
        <div class="day" data-dow="1">Mo</div>
        <div class="day" data-dow="2">Tu</div>
        <div class="day" data-dow="3">We</div>
        <div class="day" data-dow="4">Th</div>
        <div class="day" data-dow="5">Fr</div>
        <div class="day" data-dow="6">Sa</div>
      </div>

      <p class="subtext" id="status">✨ Hãy bắt đầu streak đầu tiên hôm nay!</p>

      <button class="btn-accent" id="checkin">CONTINUE</button>
      <button class="btn-subtle" id="skip">Skip (note)</button>
      <button class="btn-danger" id="reset">Reset</button>
    </div>
  </main>

  <script>
    const TIMEZONE = 'Asia/Bangkok';
    const F = new Intl.DateTimeFormat('en-CA', { timeZone: TIMEZONE, year: 'numeric', month: '2-digit', day: '2-digit' });
    const fmt = (d) => F.format(d);
    const el = (id) => document.getElementById(id);

    const store = {
      read() {
        const raw = JSON.parse(localStorage.getItem('streak-data') || '{}');
        return {
          count: raw.count ?? 0,
          best: raw.best ?? 0,
          lastDate: raw.lastDate ?? null,
          notes: raw.notes ?? [],
          tz: raw.tz || TIMEZONE,
        };
      },
      write(data) {
        localStorage.setItem('streak-data', JSON.stringify(data));
      }
    };

    function getToday() { return fmt(new Date()); }
    function getYesterdayStr() {
      const now = new Date();
      const parts = F.formatToParts(now).reduce((a, p) => (a[p.type] = p.value, a), {});
      const tzDate = new Date(`${parts.year}-${parts.month}-${parts.day}T00:00:00`);
      tzDate.setDate(tzDate.getDate() - 1);
      return fmt(tzDate);
    }

    function highlightToday(data) {
      const days = document.querySelectorAll('.day');
      days.forEach(d => d.classList.remove('checked'));
      if (data.lastDate) {
        const d = new Date(data.lastDate + "T00:00:00");
        const dow = d.getDay();
        document.querySelector(`.day[data-dow="${dow}"]`).classList.add('checked');
      }
    }

    function updateUI() {
      const data = store.read();
      el('streak').textContent = data.count;

      const today = getToday();
      const y = getYesterdayStr();

      let status = '';
      let canCheck = true;

      if (data.lastDate === today) {
        status = '✅ Đã check-in hôm nay (' + today + ').';
        canCheck = false;
      } else if (data.lastDate === y) {
        status = '🟦 Tiếp tục streak – hôm qua bạn đã check-in.';
      } else if (data.lastDate == null) {
        status = '✨ Hãy bắt đầu streak đầu tiên hôm nay!';
      } else {
        status = '⚠️ Bị gián đoạn từ ' + data.lastDate + '. Nhấn để bắt đầu lại.';
      }

      el('status').textContent = status;
      const btn = el('checkin');
      btn.disabled = !canCheck;
      btn.textContent = (canCheck ? '✅ Check-in hôm nay' : 'Đã check-in hôm nay');

      highlightToday(data);
    }

    function checkIn() {
      const data = store.read();
      const today = getToday();
      const y = getYesterdayStr();

      if (data.lastDate === today) return;

      if (data.lastDate === y) {
        data.count = (data.count || 0) + 1;
      } else {
        data.count = 1;
      }
      if (data.count > (data.best || 0)) data.best = data.count;

      data.lastDate = today;
      data.tz = TIMEZONE;
      store.write(data);
      updateUI();
    }

    function resetAll() {
      if (!confirm('Đặt lại toàn bộ dữ liệu streak trên trình duyệt này?')) return;
      store.write({ count: 0, best: 0, lastDate: null, notes: [], tz: TIMEZONE });
      updateUI();
    }

    function addNoteMissed() {
      const d = prompt('Mô tả ngắn lý do bạn bỏ lỡ (tuỳ chọn):');
      const data = store.read();
      const today = getToday();
      data.notes = data.notes || [];
      data.notes.push({ when: today, text: d || '—' });
      store.write(data);
      alert('Đã ghi chú. Cố gắng check-in đều nhé!');
    }

    document.getElementById('checkin').addEventListener('click', checkIn);
    document.getElementById('reset').addEventListener('click', resetAll);
    document.getElementById('skip').addEventListener('click', addNoteMissed);

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(() => console.log("Service Worker registered"))
        .catch((err) => console.log("SW registration failed:", err));
    }

    updateUI();
  </script>
</body>
</html>
